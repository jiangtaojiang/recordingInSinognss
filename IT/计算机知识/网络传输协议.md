##### IP地址表示方法

1. IP地址就是给英特网上的每个主机（路由器）的每个接口分配一个在全世界范围内是唯一的32位的标识符。

2. IP组成第一个字段是网络号，第二个字段是主机号。一个主机号在前面的网络号所指明的网络范围内必须是唯一的，所以一个IP地址在整个网络中都是唯一的。目前分为A、B、C、D、E 五类IP地址。

   1. 在A、B、C 三类地址中灰色的部分即为网络号，网络号的前三位是类别位，分别是0,10，110。也就是说我们可以凭借这个类别位置来判断网络类别。
   2. 32位的总长度，由于A、B、C 三类网络号的长度的不同，导致A、B、C 类地址的主机号字段的字节数分别为3、2、1（一个字节8位）。
   3. D 类地址的网络号为1110，用于多播（一对多通讯）。E 类地址的网络号为1111，保留以后使用。

3. 因此我们一般使用的就是ABC三类网络地址，IP地址是32位的二进制代码，为了提高可读性，把32位的IP地址中的每8位用等效的十进制表示出来（点分十进制），于是我们日常生活中常见的IP地址就出现了。

   例如：**IP地址，128.11.3.31，**

   转化为**二进制为 100000000 00001011 00000011 00011111** 

   看出类别位为 10，可以判断为一个B类地址。

#### 规则

1. 网络号：网络字段全为0表示本网络
2. 主机号：全0的主机号代表IP地址是“本主机”所连接到的单个网络地址（例，一主机地址为5.6.7.8，则该主机所在的网络地址为5.0.0.0），而全1则表示“所有的”，即表示该网络上的所有主机。



##### 网络号指派范围

1. A类地址网络号占用一个字节，但是由于有一位是类别位，只有7位可供使用，但是由于规定，网络字段全0是个保留字段表示本网络，而127（01111111）是另外一个保留字段，作为本地软件的环回测试。我们常见的127.0.0.1表示本机，原因也是出自这里。所以A类地址可以指派的网络号个数为（27-2）.
2. B类网络地址网络号有两个字节，前两位为10已经固定，只剩下14位可用，由于这14位无论怎么取值都不会使得网络号为全0或者全1，单实际上规定，规定B类最小网络地址为128.1.0.0。因此B类地址可指派的网络号个数为（214-1）.
3. C类地址有3个字节的网络字段号，前三位固定110，只有剩下21位可用，同样C类地址可指派的最小网络地址也是192.0.1.0。因此C类地址可指派的网络号个数为（221-1）

##### 主机号指派范围

1. A类地址的主机号是由三个字节，24位组成，所以每一个A类网络中可分配的主机个数为（224-2）.
2. B类地址的主机号是由两个字节，16位组成，所以每一个B类网络中可分配的主机个数为（216-2）.
3. C类地址的主机号是由一个字节，8位组成，所以每一个C类网络中可分配的主机个数为（28-2）.



### 总结

1. IP地址空间共有2的32次方个地址。
2. 所有A类地址共有（2的7次方-2）∗（2的24次方-2）个，大约2的31次方，占50%；
3. 所有B类地址共有（2的14次方-1）∗（2的16次方-2）个，大约2的30次方,占25%；
4. 所有C类地址共有（2的21次方-1）∗（2的8次方-2）个，大约2的29次方,占12.5%；

##### 所以：

1. 表示一个A类IP地址 n.x.y.zn.x.y.z，若1≤n≤1261≤n≤126，0≤x,y,z≤2550≤x,y,z≤255，其中 x,y,zx,y,z不同时为0也不能同时为255.
2. 表示一个B类IP地址 n.m.x.yn.m.x.y，若128≤n≤191128≤n≤191，0≤m≤2550≤m≤255，0≤x,y≤2550≤x,y≤255，其中 I. 当n=128n=128时，m≠0m≠0; II. x,yx,y不同时为0也不能同时为255;
3. 这样来表示一个C类IP地址 n.m.k.xn.m.k.x，若192≤n≤223192≤n≤223，0≤m,k≤2550≤m,k≤255，1≤x≤2541≤x≤254，其中 当n=192n=192时，k≠0k≠0.



##### IP地址和硬件地址

1. 层次角度来看，硬件地址是数据链路层和物理层使用的地址（常称作MAC地址），而IP地址是网络层和以上各层使用的地址，是一种逻辑地址。
2. 在网络层我们进行数据报文从IP1传输到IP2，无论我们中间经过多少次转发，从网络层来看，源地址始终是IP1，目的地址始终是IP2。但是从数据链路层来看，显然就不是这样了，这些是物理地址，很有可能从源节点经过多次中间节点的物理地址的转变才能到达目的节点。
3. IP地址和物理地址的之间的转化则需要依靠两个重要的协议ARP（地址解析协议），RARP（逆地址解析协议）。IP地址通过ARP转化成物理地址，物理地址可以通过RARP转化成相应的IP地址。



##### 子网和超网

简单的来说就是如何来管理一个IP地址下的多台主机

##### 子网

现在假设这样一个场景，一个数据报起目的地址是145.13.3.10（在子网 145.13.3.0中），已经到达路由器R1（145.13.0.0），那么这个路由器怎么将它转发到145.13.3.0呢？
我们并不知道目的地址是否进行了子网的划分。
这就引出了子网掩码的概念了，子网掩码也是32位，由一串1和0组成

子网掩码中的1对应于IP地址中的网络号位置+子网网络号位置，子网掩码中的0对应与IP地址中现在的主机号位置。
我们只要将IP地址和子网掩码进行“与”运算，如果进行子网的划分，就立刻得出要找的子网的网络地址，如果没有进行子网划分（有默认的子网掩码），则直接能够得出该IP地址的网络地址出来。

A类地址的默认子网掩码是255.0.0.0
B类地址的默认子网掩码是255.255.0.0
C类地址的默认子网掩码是255.255.255.0

##### 超网

无分类编址CIDR，使用变长的子网掩码，可以进一步提高IP地址的资源利用率。有两个特点
第一，消除了传统的ABC类地址及划分子网的概念，CIRD把32位的IP地址划分成为两个部分，网络前缀和剩下的部分，表示方法为，在IP地址后面加上“/”，然后写上网络前缀所占位数。
第二，把网络前缀相同的IP地址组成一个CIDR地址块，例如，IP地址 128.14.35.7/20 用二进制表示 100000000 00001110 00100011 00000111，所以我们很容易可以得出这块地址中最小地址为128.14.32.0,即 100000000 00001110 00100000 00000000，最大地址为128.14.47.255，即 100000000 00001110 00101111 11111111.

为了更加方便进行路由选择，CIDR使用32位的地址掩码，1的个数就是网络前缀的长度，如上面所举例中的/20的地址块的地址掩码是 11111111 11111111 11110000 00000000

因此可以看出，网络前缀越短，其地址块所包含的地址就越多，这样可以根据实际情况更加有效的分配IPv4的地址空间。而由很多个CIDR地址快构成的庞大的网络就就被称为“超网”。



路由（routing）

​	指分组从源到目的地时，决定端到端路径的网络范围的进程  。路由工作在OSI参考模型第三层——网络层的数据包转发设备。路由器通过转发数据包来实现网络互连。虽然路由器可以支持多种协议（如TCP/IP、IPX/SPX、AppleTalk等协议），但是在我国绝大多数路由器运行TCP/IP协议。路由器通常连接两个或多个由IP子网或点到点协议标识的逻辑端口，至少拥有1个物理端口。路由器根据收到数据包中的网络层地址以及路由器内部维护的路由表决定输出端口以及下一跳地址，并且重写链路层数据包头实现转发数据包。路由器通过动态维护路由表来反映当前的网络拓扑，并通过网络上其他路由器交换路由和链路信息来维护路由表。







## OSI（Open System Interconnection）协议

分层，各层之间互不影响

在通信主机上完成的功能：**应用层，表示层，会话层，传输层**

在网络设备上实现的功能：**网络层，数据链路层，物理层**



#### 物理层

它就是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。

#### 链路层

单纯的0和1没有任何意义，必须规定解读方式：多少个电信号算一组？每个信号位有何意义？
这就是"链接层"的功能，它在"实体层"的上方，确定了0和1的分组方式。

**"以太网"（Ethernet）协议**，占据主导地位。
以太网规定，一组电信号构成一个数据包，叫做"帧"（Frame）。每一帧分成两个部分：标头（Head）和数据（Data）。

标头"包含数据包的一些说明项，比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。
"标头"的长度，固定为18字节。"数据"的长度，最短为46字节，最长为1500字节。因此，整个"帧"最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。

**MAC地址**
以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。

ARP协议。以太网数据包得到MAC地址，发送数据包。

##### "网络层"的诞生

它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。

"网络层"出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。
网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。

#### IP协议

规定网络地址的协议，叫做IP协议。它所定义的地址，就被称为IP地址。目前，广泛采用的是IP协议第四版，简称IPv4。
IPv4这个版本规定，网络地址由32个二进制位组成。

处于同一个子网络的电脑，它们IP地址的网络部分必定是相同的。

##### 子网掩码

就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.254.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。

IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。

#### IP数据包

根据IP协议发送的数据，就叫做IP数据包

IP数据包也分为"标头"和"数据"两个部分：

​	"标头"部分主要包括版本、长度、IP地址等信息，"数据"部分则是IP数据包的具体内容。它放进以太网数据包后，以太网数据包就变为如下：

​	IP数据包的"标头"部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个IP数据包的"数据"部分，最长为65,515字节。由于，以太网数据包的"数据"部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。

#### ARP协议

​	关于"网络层"，还有最后一点需要说明。因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的，但是我们不知道它的MAC地址。

这里又可以分成两种情况：


1）第一种情况：如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理；
2）第二种情况：如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。

ARP协议使我们得到同一个子网络内的主机MAC地址，可以把数据包发送到任意一台主机之上了。

#### 传输层

有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机上建立通信。

传输层目的：解决主机从网络上识别数据包

我们需要一个参数，表示这个数据包到底供哪个程序（进程）使用。这个参数就叫做"端口"（port），它其实是每一个使用网卡的程序的编号。每个数据包都发到主机的特定端口，所以不同的程序就能取到自己所需要的数据。

**"传输层"的功能，就是建立"端口到端口"的通信。相比之下，"网络层"的功能是建立"主机到主机"的通信。只要确定主机和端口，我们就能实现程序之间的交流。**

## Socket

**因此，Unix系统就把主机+端口，叫做"套接字"（socket）。有了它，就可以进行网络应用程序开发了。**



#### 应用层

应用程序收到"传输层"的数据，接下来就要进行解读。由于互联网是开放架构，数据来源五花八门，必须事先规定好格式，否则根本无法解读。"应用层"的作用，就是规定应用程序的数据格式。

举例来说，TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了"应用层"。这是最高的一层，直接面对用户。它的数据就放在TCP数据包的"数据"部分。





## 传输层的两种协议-UDP和TCP

### UDP协议

我们必须在数据包中加入端口信息，这就需要新的协议。最简单的实现叫做UDP协议，它的格式几乎就是在数据前面，加上端口号。

UDP数据包，也是由"标头"和"数据"两部分组成：

标头"部分主要定义了发出端口和接收端口，"数据"部分就是具体的内容。然后，把整个UDP数据包放入IP数据包的"数据"部分，而前面说过，IP数据包又是放在以太网数据包之中的，所以整个以太网数据包现在变成了下面这样：

UDP数据包非常简单，"标头"部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。

UDP 首部格式

1. 源端口
2. 目的端口
3. 长度
4. 检验和





#### TCP协议

UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。为了解决这个问题，提高网络可靠性，TCP协议就诞生了。这个协议非常复杂，但可以近似认为，它就是有确认机制的UDP协议，每发出一个数据包都要求确认。如果有一个数据包遗失，就收不到确认，发出方就知道有必要重发这个数据包了。

因此，TCP协议能够确保数据不会遗失。它的缺点是过程复杂、实现困难、消耗较多的资源。

TCP数据包和UDP数据包一样，都是内嵌在IP数据包的"数据"部分。TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。































